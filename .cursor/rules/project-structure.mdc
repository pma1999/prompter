---
alwaysApply: true
---
# Prompt Perfection â€“ Project Structure Guide

This repo is a Next.js App Router frontend for crafting perfect prompts for Gemini models. Start here:

- App entry: [frontend/src/app/page.tsx](mdc:frontend/src/app/page.tsx)
- Root layout & providers injection: [frontend/src/app/layout.tsx](mdc:frontend/src/app/layout.tsx) and [frontend/src/components/providers.tsx](mdc:frontend/src/components/providers.tsx)
- Main workspace composition: [frontend/src/components/workspace/Workspace.tsx](mdc:frontend/src/components/workspace/Workspace.tsx)

## Key Directories

- UI components (shadcn): [frontend/src/components/ui/](mdc:frontend/src/components/ui/)
- App shell & common widgets: [frontend/src/components/app/](mdc:frontend/src/components/app/) and [frontend/src/components/common/](mdc:frontend/src/components/common/)
- Feature UI: [frontend/src/components/workspace/](mdc:frontend/src/components/workspace/)
- Domain types: [frontend/src/domain/types.ts](mdc:frontend/src/domain/types.ts)
- Libraries:
  - Model registry: [frontend/src/lib/models.ts](mdc:frontend/src/lib/models.ts)
  - Instruction presets (derived per family): [frontend/src/lib/instructionPresets.ts](mdc:frontend/src/lib/instructionPresets.ts)
  - Local session persistence: [frontend/src/lib/persistence.ts](mdc:frontend/src/lib/persistence.ts)
  - Token/length estimate: [frontend/src/lib/token.ts](mdc:frontend/src/lib/token.ts)
  - Command bus: [frontend/src/lib/commandBus.ts](mdc:frontend/src/lib/commandBus.ts)
  - Server Gemini client: [frontend/src/lib/server/gemini.ts](mdc:frontend/src/lib/server/gemini.ts)
  - Refine orchestrator & schemas: [frontend/src/lib/server/refineService.ts](mdc:frontend/src/lib/server/refineService.ts), [frontend/src/lib/server/refineSchema.ts](mdc:frontend/src/lib/server/refineSchema.ts)
  - Caching utilities: [frontend/src/lib/server/cacheService.ts](mdc:frontend/src/lib/server/cacheService.ts)
  - Token counting service: [frontend/src/lib/server/tokenService.ts](mdc:frontend/src/lib/server/tokenService.ts)
  - Client APIs: [frontend/src/lib/api/refine.ts](mdc:frontend/src/lib/api/refine.ts), [frontend/src/lib/api/tokens.ts](mdc:frontend/src/lib/api/tokens.ts)
  - Model token budgets: [frontend/src/lib/modelLimits.ts](mdc:frontend/src/lib/modelLimits.ts)

## Composition Overview

- `Workspace` orchestrates:
  - Model selection: [ModelSwitch.tsx](mdc:frontend/src/components/workspace/ModelSwitch.tsx)
  - Minimal tips banner: [GuidePanel.tsx](mdc:frontend/src/components/workspace/GuidePanel.tsx)
  - Image templates: [ImageTemplatePicker.tsx](mdc:frontend/src/components/workspace/ImageTemplatePicker.tsx)
  - Raw input: [RawPromptInput.tsx](mdc:frontend/src/components/workspace/RawPromptInput.tsx)
  - Clarifications: [ClarificationPanel.tsx](mdc:frontend/src/components/workspace/ClarificationPanel.tsx)
  - Actions: [ActionBar.tsx](mdc:frontend/src/components/workspace/ActionBar.tsx)
  - Preview/Final: [PreviewAndFinal.tsx](mdc:frontend/src/components/workspace/PreviewAndFinal.tsx)
  - Sessions sidebar: [SessionsSidebar.tsx](mdc:frontend/src/components/workspace/SessionsSidebar.tsx)

## Providers

- Theming (`next-themes`), React Query (`@tanstack/react-query`), and toasts (`sonner`) are wired in [providers.tsx](mdc:frontend/src/components/providers.tsx).

## Routing & Assets

- Global styles: [frontend/src/app/globals.css](mdc:frontend/src/app/globals.css)
- SEO/util files: [manifest.webmanifest](mdc:frontend/src/app/manifest.webmanifest), [robots.txt](mdc:frontend/src/app/robots.txt), [sitemap.xml](mdc:frontend/src/app/sitemap.xml)
 - Tokens preflight API: [frontend/src/app/api/tokens/count/route.ts](mdc:frontend/src/app/api/tokens/count/route.ts)

## Backend Integration Pointers (next step)

- Strong types live in [domain/types.ts](mdc:frontend/src/domain/types.ts) (`RefineRequest`, `RefineResponse`).
- Replace mock refinement in `Workspace` with a typed API client (recommended location: `frontend/src/lib/api/refine.ts`).
- Use React Query mutations for `/api/refine` and `/api/refine/{conversationId}`; validate responses with zod before updating UI state.

## shadcn Usage

- All shadcn components are under `components/ui` and imported via `@/components/ui/*`. Prefer composition and variant props over custom CSS.

